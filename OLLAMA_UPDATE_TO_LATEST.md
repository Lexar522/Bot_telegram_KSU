# üîÑ –û–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ –æ—Å—Ç–∞–Ω–Ω—å–æ—ó –≤–µ—Ä—Å—ñ—ó OLLAMA API

## ‚úÖ –í–∏–∫–æ–Ω–∞–Ω—ñ –∑–º—ñ–Ω–∏

### 1. –û–Ω–æ–≤–ª–µ–Ω–æ API –≤–∏–∫–ª–∏–∫–∏

**–§–∞–π–ª:** `ollama_optimized/client.py`

#### –ó–º—ñ–Ω–∏:
- ‚úÖ –î–æ–¥–∞–Ω–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –Ω–æ–≤–æ–≥–æ `/api/chat` endpoint (OLLAMA 0.11+)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π fallback –Ω–∞ `/api/generate` –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ –∑—ñ —Å—Ç–∞—Ä–∏–º–∏ –≤–µ—Ä—Å—ñ—è–º–∏
- ‚úÖ –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø—Ä–æ–º–ø—Ç—ñ–≤ —á–µ—Ä–µ–∑ chat API
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —á–µ—Ä–µ–∑ messages array

#### –ù–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Ç—É:

**–°—Ç–∞—Ä–∏–π —Ñ–æ—Ä–º–∞—Ç (generate API):**
```json
{
  "model": "llama3.1:8b",
  "prompt": "—Å–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç + –ø–∏—Ç–∞–Ω–Ω—è",
  "stream": false,
  "options": {...}
}
```

**–ù–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç (chat API):**
```json
{
  "model": "llama3.1:8b",
  "messages": [
    {
      "role": "system",
      "content": "—Å–∏—Å—Ç–µ–º–Ω–∏–π –ø—Ä–æ–º–ø—Ç"
    },
    {
      "role": "user",
      "content": "–ø–∏—Ç–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"
    }
  ],
  "stream": false,
  "options": {...}
}
```

### 2. –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç—É —Ç–∞ –ø–∏—Ç–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- ‚úÖ –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –¥–æ messages array
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±–∞–≥–∞—Ç–æ–æ–±—ñ–≥–æ–≤–∏—Ö –¥—ñ–∞–ª–æ–≥—ñ–≤

### 3. –û–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤'—è

- ‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `/api/tags` –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ
- ‚úÖ Fallback –Ω–∞ `/api/version` –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ

## üéØ –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ–≥–æ API

1. **–ö—Ä–∞—â–∞ —Ä–æ–±–æ—Ç–∞ –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º**
   - –°–∏—Å—Ç–µ–º–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏ –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –ø–∏—Ç–∞–Ω—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
   - –ö—Ä–∞—â–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è –º–æ–¥–µ–ª–ª—é —Ä–æ–ª—ñ —Ç–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π

2. **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –¥—ñ–∞–ª–æ–≥—ñ–≤**
   - –õ–µ–≥—à–µ –¥–æ–¥–∞–≤–∞—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
   - –ö—Ä–∞—â–∞ —è–∫—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –≤ –±–∞–≥–∞—Ç–æ–æ–±—ñ–≥–æ–≤–∏—Ö –¥—ñ–∞–ª–æ–≥–∞—Ö

3. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü—ñ—è**
   - –í—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º OpenAI API
   - –õ–µ–≥—à–µ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –∑ —ñ–Ω—à–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

4. **–°—É–º—ñ—Å–Ω—ñ—Å—Ç—å**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π fallback –Ω–∞ —Å—Ç–∞—Ä–∏–π API
   - –ü—Ä–∞—Ü—é—î –∑ –±—É–¥—å-—è–∫–æ—é –≤–µ—Ä—Å—ñ—î—é OLLAMA

## üìã –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è API

1. **–°–ø—Ä–æ–±–∞ 1:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `/api/chat` (–Ω–æ–≤–∞ –≤–µ—Ä—Å—ñ—è)
2. **–Ø–∫—â–æ –Ω–µ –ø—Ä–∞—Ü—é—î:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ `/api/generate` (—Å—Ç–∞—Ä–∞ –≤–µ—Ä—Å—ñ—è)
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∞—Ü—é—î –∑ –±—É–¥—å-—è–∫–æ—é –≤–µ—Ä—Å—ñ—î—é OLLAMA

### –û–±—Ä–æ–±–∫–∞ –ø—Ä–æ–º–ø—Ç—ñ–≤

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è
system_prompt = "–¢–∏ - –ø–æ–º—ñ—á–Ω–∏–∫..."
user_message = "–Ø–∫—ñ —î —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∏?"

# –§–æ—Ä–º—É–≤–∞–Ω–Ω—è messages
messages = [
    {"role": "system", "content": system_prompt},
    {"role": "user", "content": user_message}
]
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

```python
# –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
context = [
    {"user_message": "–ü—Ä–∏–≤—ñ—Ç", "bot_response": "–í—ñ—Ç–∞—é!"},
    {"user_message": "–Ø–∫—ñ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∏?", "bot_response": "–í –•–î–£ —î 8 —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—ñ–≤..."}
]

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ messages
messages = [
    {"role": "system", "content": system_prompt},
    {"role": "user", "content": "–ü—Ä–∏–≤—ñ—Ç"},
    {"role": "assistant", "content": "–í—ñ—Ç–∞—é!"},
    {"role": "user", "content": "–Ø–∫—ñ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∏?"},
    {"role": "assistant", "content": "–í –•–î–£ —î 8 —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—ñ–≤..."},
    {"role": "user", "content": user_message}
]
```

## üîß –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### –ú–µ—Ç–æ–¥ `_generate_with_retry()`

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç—É —Ç–∞ –ø–∏—Ç–∞–Ω–Ω—è
- ‚úÖ –§–æ—Ä–º—É–≤–∞–Ω–Ω—è messages array –¥–ª—è chat API
- ‚úÖ –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- ‚úÖ Fallback –Ω–∞ generate API –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö

### –û–±—Ä–æ–±–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π

**–ù–æ–≤–∏–π —Ñ–æ—Ä–º–∞—Ç (chat API):**
```json
{
  "message": {
    "role": "assistant",
    "content": "–≤—ñ–¥–ø–æ–≤—ñ–¥—å"
  }
}
```

**–°—Ç–∞—Ä–∏–π —Ñ–æ—Ä–º–∞—Ç (generate API):**
```json
{
  "response": "–≤—ñ–¥–ø–æ–≤—ñ–¥—å"
}
```

–ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–±—Ä–æ–±–ª—è—î –æ–±–∏–¥–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∏.

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ü—Ä–∞—Ü—é—î –∑ OLLAMA 0.11+ (–Ω–æ–≤–∏–π chat API)
- ‚úÖ –ü—Ä–∞—Ü—é—î –∑—ñ —Å—Ç–∞—Ä–∏–º–∏ –≤–µ—Ä—Å—ñ—è–º–∏ (fallback –Ω–∞ generate API)
- ‚úÖ –ö—Ä–∞—â–∞ —è–∫—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –∑–∞–≤–¥—è–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –æ–±—Ä–æ–±—Ü—ñ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –ø—Ä–æ–º–ø—Ç—ñ–≤
- ‚úÖ –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±–∞–≥–∞—Ç–æ–æ–±—ñ–≥–æ–≤–∏—Ö –¥—ñ–∞–ª–æ–≥—ñ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ API

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

–ù—ñ—á–æ–≥–æ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ –≤ –∫–æ–¥—ñ! –í—Å–µ –ø—Ä–∞—Ü—é—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:

```python
from ollama_optimized.client import OptimizedOllamaClient

client = OptimizedOllamaClient()
response = await client.generate_response("–Ø–∫—ñ —î —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∏?")
```

–ö–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
1. –í–∏–∑–Ω–∞—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—É –≤–µ—Ä—Å—ñ—é OLLAMA
2. –í–∏–∫–æ—Ä–∏—Å—Ç–∞—î –Ω–∞–π–∫—Ä–∞—â–∏–π –¥–æ—Å—Ç—É–ø–Ω–∏–π API
3. –û–±—Ä–æ–±–∏—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- –Ø–∫—â–æ —É –≤–∞—Å OLLAMA 0.11+, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –Ω–æ–≤–∏–π chat API
- –Ø–∫—â–æ —Å—Ç–∞—Ä—ñ—à–∞ –≤–µ—Ä—Å—ñ—è, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è generate API
- –í—Å—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–∞—Ü—é—é—Ç—å –∑ –æ–±–æ–º–∞ –≤–µ—Ä—Å—ñ—è–º–∏

**–û–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–æ! üéâ**

