# üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ —Ç–∞ —Ç–æ—á–Ω–æ—Å—Ç—ñ OLLAMA –º–æ–¥–µ–ª—ñ

## üìä –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω

### ‚úÖ –©–æ –≤–∂–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ:
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –∫–ª—ñ—î–Ω—Ç –∑ –∫–µ—à—É–≤–∞–Ω–Ω—è–º
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –ø–∏—Ç–∞–Ω—å
- –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- –ë–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
- –ú–µ—Ç—Ä–∏–∫–∏ —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥
- Chain-of-Thought –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –ø–∏—Ç–∞–Ω—å
- –ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø–∏—Ç–∞–Ω—å

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∏ —Ç–∞ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è:
1. **–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó** - –º–æ–∂–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –¥–ª—è –∫—Ä–∞—â–æ—ó —Ç–æ—á–Ω–æ—Å—Ç—ñ
2. **–ü—Ä–æ–º–ø—Ç–∏** - –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –±—ñ–ª—å—à —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∏–º–∏ —Ç–∞ —á—ñ—Ç–∫–∏–º–∏
3. **–ö–æ–Ω—Ç–µ–∫—Å—Ç** - –º–æ–∂–Ω–∞ –∫—Ä–∞—â–µ –æ–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä
4. **Streaming** - –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è (–º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å)
5. **–ü–∞—Ä–∞–ª–µ–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞** - –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è
6. **–ö–µ—à—É–≤–∞–Ω–Ω—è** - –º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é

---

## üéØ –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ

### 1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Streaming API

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞—Ä–∞–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `stream: False`, —â–æ –æ–∑–Ω–∞—á–∞—î –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–æ–≤–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.

**–†—ñ—à–µ–Ω–Ω—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ streaming –¥–ª—è —à–≤–∏–¥—à–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π:

```python
async def _generate_with_streaming(
    self, 
    prompt: str, 
    params: Dict,
    context: List[Dict] = None
) -> str:
    """–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∑ streaming –¥–ª—è —à–≤–∏–¥—à–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π"""
    messages = self._prepare_messages(prompt, context)
    
    async with aiohttp.ClientSession() as session:
        payload = {
            "model": self.model,
            "messages": messages,
            "stream": True,  # –£–≤—ñ–º–∫–Ω—É—Ç–∏ streaming
            "options": params
        }
        
        full_response = ""
        async with session.post(
            f"{self.api_url}/api/chat",
            json=payload,
            timeout=aiohttp.ClientTimeout(total=60)
        ) as response:
            if response.status == 200:
                async for line in response.content:
                    if line:
                        try:
                            chunk = json.loads(line)
                            if "message" in chunk:
                                content = chunk["message"].get("content", "")
                                if content:
                                    full_response += content
                                    # –ú–æ–∂–Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ —á–∞—Å—Ç–∏–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É
                                    # await self._send_partial_response(content)
                        except json.JSONDecodeError:
                            continue
        
        return full_response
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:** 
- ‚ö° –®–≤–∏–¥–∫—ñ—Å—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ: **-40-60%** —á–∞—Å—É –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
- üí¨ –ö—Ä–∞—â–∏–π UX: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ø–æ –º—ñ—Ä—ñ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó

---

### 2. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Ç–æ—á–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –∫–µ—à—É–≤–∞–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –∫—Ä–∞—â–æ—é.

**–†—ñ—à–µ–Ω–Ω—è:** –î–æ–¥–∞—Ç–∏ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–µ –∫–µ—à—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ–∫—Ä–∞—â–µ–Ω—É –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—é:

```python
class EnhancedResponseCache(ResponseCache):
    """–ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –∫–µ—à –∑ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–∏–º –ø–æ—à—É–∫–æ–º"""
    
    def __init__(self, max_size: int = 500, ttl_hours: int = 24):
        super().__init__(max_size, ttl_hours)
        self.semantic_cache = {}  # –î–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ —Å—Ö–æ–∂–∏—Ö –ø–∏—Ç–∞–Ω—å
    
    def _semantic_similarity(self, query1: str, query2: str) -> float:
        """–û–±—á–∏—Å–ª–µ–Ω–Ω—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ—ó —Å—Ö–æ–∂–æ—Å—Ç—ñ (—Å–ø—Ä–æ—â–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è)"""
        # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ Jaccard similarity –¥–ª—è –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤
        words1 = set(self._extract_keywords(query1))
        words2 = set(self._extract_keywords(query2))
        
        if not words1 or not words2:
            return 0.0
        
        intersection = len(words1 & words2)
        union = len(words1 | words2)
        
        return intersection / union if union > 0 else 0.0
    
    def get_semantic(self, query: str, context: Dict, threshold: float = 0.7) -> Optional[str]:
        """–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ —Å—Ö–æ–∂–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ"""
        normalized_query = self._normalize_query(query)
        
        # –®—É–∫–∞—î–º–æ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ —Å—Ö–æ–∂—ñ –∑–∞–ø–∏—Ç–∏
        for cached_query, cached_response in self.semantic_cache.items():
            similarity = self._semantic_similarity(normalized_query, cached_query)
            if similarity >= threshold:
                return cached_response
        
        return None
    
    def _extract_keywords(self, query: str) -> List[str]:
        """–í–∏—Ç—è–≥—É–≤–∞–Ω–Ω—è –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤"""
        stop_words = {"—è–∫", "—â–æ", "–¥–µ", "–∫–æ–ª–∏", "—á–∏", "–¥–ª—è", "–ø—Ä–æ", "–Ω–∞", "–≤", "–∑", "—Ç–∞", "—ñ", "–∞–±–æ"}
        words = re.findall(r'\b\w+\b', query.lower())
        return [w for w in words if w not in stop_words and len(w) > 2]
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:**
- ‚ö° Cache hit rate: **+20-30%** (–∑ 30% –¥–æ 50-60%)
- üíæ –®–≤–∏–¥–∫—ñ—Å—Ç—å: **+50%** –¥–ª—è —Å—Ö–æ–∂–∏—Ö –ø–∏—Ç–∞–Ω—å

---

### 3. –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –ø–∏—Ç–∞–Ω—å

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∫–ª–∞–¥–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ.

**–†—ñ—à–µ–Ω–Ω—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω—É –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é –∑ —Ä—ñ–∑–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```python
async def _generate_parallel_candidates(
    self,
    prompt: str,
    base_params: Dict,
    context: List[Dict] = None
) -> List[str]:
    """–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫—ñ–ª—å–∫–æ—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ"""
    
    # –°—Ç–≤–æ—Ä—é—î–º–æ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
    param_variants = [
        {**base_params, "temperature": base_params["temperature"] * 0.5},  # –ë—ñ–ª—å—à –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∏–π
        base_params,  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π
        {**base_params, "temperature": min(0.3, base_params["temperature"] * 1.5)},  # –ë—ñ–ª—å—à –∫—Ä–µ–∞—Ç–∏–≤–Ω–∏–π
    ]
    
    # –ì–µ–Ω–µ—Ä—É—î–º–æ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
    tasks = [
        self._generate_with_retry(prompt, params, max_retries=1, context=context)
        for params in param_variants
    ]
    
    candidates = await asyncio.gather(*tasks, return_exceptions=True)
    
    # –§—ñ–ª—å—Ç—Ä—É—î–º–æ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ –ø–æ—Ä–æ–∂–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
    valid_candidates = [
        c for c in candidates 
        if isinstance(c, str) and len(c.strip()) > 20
    ]
    
    return valid_candidates

async def _select_best_response(
    self,
    candidates: List[str],
    prompt: str
) -> str:
    """–í–∏–±—ñ—Ä –Ω–∞–π–∫—Ä–∞—â–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤"""
    if not candidates:
        return ""
    
    if len(candidates) == 1:
        return candidates[0]
    
    # –û—Ü—ñ–Ω—é—î–º–æ –∫–æ–∂–Ω–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞
    scores = []
    for candidate in candidates:
        score = self._score_response(candidate, prompt)
        scores.append((score, candidate))
    
    # –°–æ—Ä—Ç—É—î–º–æ –∑–∞ –æ—Ü—ñ–Ω–∫–æ—é —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –Ω–∞–π–∫—Ä–∞—â—É
    scores.sort(reverse=True, key=lambda x: x[0])
    return scores[0][1]

def _score_response(self, response: str, prompt: str) -> float:
    """–û—Ü—ñ–Ω–∫–∞ —è–∫–æ—Å—Ç—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ"""
    score = 0.0
    
    # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó
    validation = self.validator.validate(response, prompt)
    if validation.is_valid:
        score += 50.0
    else:
        score -= 20.0
    
    # –î–æ–≤–∂–∏–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞ 100-400 —Å–∏–º–≤–æ–ª—ñ–≤)
    length = len(response)
    if 100 <= length <= 400:
        score += 20.0
    elif length < 50:
        score -= 10.0
    elif length > 1000:
        score -= 5.0
    
    # –ù–∞—è–≤–Ω—ñ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö
    if any(word in response.lower() for word in ["–≥—Ä–Ω", "–≥–æ–¥–∏–Ω", "—Ä–æ–∫—ñ–≤", "–º—ñ—Å—è—Ü—ñ–≤"]):
        score += 15.0
    
    # –ù–∞—è–≤–Ω—ñ—Å—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤
    if "+380" in response or "494375" in response:
        score += 10.0
    
    # –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏—Ö —Å–ª—ñ–≤
    if not any(word in response.lower() for word in ["—Ö–Ω—É", "–∫–Ω—É", "–ª—å–≤—ñ–≤—Å—å–∫–∏–π"]):
        score += 5.0
    
    return score
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:**
- üéØ –¢–æ—á–Ω—ñ—Å—Ç—å: **+10-15%** (–≤–∏–±—ñ—Ä –Ω–∞–π–∫—Ä–∞—â–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ)
- ‚ö° –®–≤–∏–¥–∫—ñ—Å—Ç—å: **+20%** (–ø–∞—Ä–∞–ª–µ–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞)

---

## üéØ –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç—ñ

### 4. –ü–æ—Ç–æ—á–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó

**–ü–æ—Ç–æ—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ (–∑ ollama_optimized/client.py):**

```python
# –ü–û–¢–û–ß–ù–Ü –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ (–∑ ollama_optimized/client.py)
CURRENT_GENERATION_PARAMS = {
    "factual": {
        "temperature": 0.05,  # –ù–∏–∑—å–∫–∞ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç—ñ
        "top_p": 0.4,  # –ó–≤—É–∂–µ–Ω–∏–π –¥–ª—è —Ñ–æ–∫—É—Å—É
        "num_predict": 300,  # –ë—ñ–ª—å—à–µ –¥–ª—è –ø–æ–≤–Ω–æ—Ç–∏
        "repeat_penalty": 1.5,  # –í–∏—â–∞ –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä—ñ–≤
        "top_k": 25  # –ú–µ–Ω—à–µ –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç—ñ
    },
    "admission": {
        "temperature": 0.0,  # –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç—ñ
        "top_p": 0.25,  # –î—É–∂–µ –∑–≤—É–∂–µ–Ω–∏–π
        "num_predict": 500,  # –ë—ñ–ª—å—à–µ –¥–ª—è –ø–æ–≤–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
        "repeat_penalty": 1.5,
        "top_k": 15  # –ú—ñ–Ω—ñ–º—É–º –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
    },
    "tuition": {
        "temperature": 0.0,  # –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç—ñ —Ü–∏—Ñ—Ä
        "top_p": 0.25,
        "num_predict": 400,
        "repeat_penalty": 1.5,
        "top_k": 15
    },
    "comparison": {
        "temperature": 0.15,  # –¢—Ä–æ—Ö–∏ –≤–∏—â–∞ –¥–ª—è —Ç–≤–æ—Ä—á–æ—Å—Ç—ñ
        "top_p": 0.6,
        "num_predict": 600,
        "repeat_penalty": 1.6,
        "top_k": 35
    },
    "faculties": {
        "temperature": 0.05,
        "top_p": 0.4,
        "num_predict": 350,
        "repeat_penalty": 1.4,
        "top_k": 25
    },
    "procedural": {
        "temperature": 0.1,  # –¢—Ä–æ—Ö–∏ –≤–∏—â–∞ –¥–ª—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ
        "top_p": 0.5,
        "num_predict": 450,
        "repeat_penalty": 1.5,
        "top_k": 30
    },
}
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –¶–µ –ø–æ—Ç–æ—á–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –∑ `ollama_optimized/client.py`. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –º–æ–∂–Ω–∞ –æ–±–≥–æ–≤–æ—Ä–∏—Ç–∏ –æ–∫—Ä–µ–º–æ, —è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

---

### 5. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–º–ø—Ç—ñ–≤

**–î–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:**

```python
ENHANCED_SYSTEM_PROMPT = """–¢–∏ - –µ–∫—Å–ø–µ—Ä—Ç–Ω–∏–π –ø–æ–º—ñ—á–Ω–∏–∫ –∞–±—ñ—Ç—É—Ä—ñ—î–Ω—Ç–∞ –•–µ—Ä—Å–æ–Ω—Å—å–∫–æ–≥–æ –¥–µ—Ä–∂–∞–≤–Ω–æ–≥–æ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É (–•–î–£).

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéØ –¢–í–û–Ø –ó–ê–î–ê–ß–ê (–í–ò–ö–û–ù–ê–ô –í–°–Ü –ö–†–û–ö–ò):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–ö–†–û–ö 1: –ê–ù–ê–õ–Ü–ó –ü–ò–¢–ê–ù–ù–Ø (–û–ë–û–í'–Ø–ó–ö–û–í–û!)
- –£–≤–∞–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–π –ø–∏—Ç–∞–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –í–∏–∑–Ω–∞—á: –ø—Ä–æ —â–æ —Å–∞–º–µ –ø–∏—Ç–∞—é—Ç—å? (–≤—Å—Ç—É–ø, –≤–∞—Ä—Ç—ñ—Å—Ç—å, —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∏)
- –í–∏–∑–Ω–∞—á: —è–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø–æ—Ç—Ä—ñ–±–Ω–∞?
- –í–∏–∑–Ω–∞—á: —è–∫—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ –≤ –ø–∏—Ç–∞–Ω–Ω—ñ?

–ö–†–û–ö 2: –ü–û–®–£–ö –í –ë–ê–ó–Ü –ó–ù–ê–ù–¨ (–¢–Ü–õ–¨–ö–ò –ó –ë–ê–ó–ò!)
- –ó–Ω–∞–π–¥–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É —Å–µ–∫—Ü—ñ—é –≤ –±–∞–∑—ñ –∑–Ω–∞–Ω—å
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –¢–Ü–õ–¨–ö–ò –¥–∞–Ω—ñ –∑ –±–∞–∑–∏ –∑–Ω–∞–Ω—å (–Ω—ñ—á–æ–≥–æ –Ω–µ –≤–∏–≥–∞–¥—É–π!)
- –Ø–∫—â–æ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –Ω–µ–º–∞—î - —á–µ—Å–Ω–æ —Å–∫–∞–∂–∏ —Ç–∞ –ø–æ—Ä–∞–¥—å –∑–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –ø—Ä–∏–π–º–∞–ª—å–Ω–æ—ó –∫–æ–º—ñ—Å—ñ—ó

–ö–†–û–ö 3: –§–û–†–ú–£–í–ê–ù–ù–Ø –í–Ü–î–ü–û–í–Ü–î–Ü (–°–¢–†–£–ö–¢–£–†–û–í–ê–ù–û!)
- –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –ü–†–Ø–ú–û –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è (–Ω–µ —É—Ö–∏–ª—è–π—Å—è)
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–∞–Ω—ñ (—Ü–∏—Ñ—Ä–∏, –¥–∞—Ç–∏, –Ω–∞–∑–≤–∏)
- –°—Ç—Ä—É–∫—Ç—É—Ä—É–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ª–æ–≥—ñ—á–Ω–æ (2-4 —Ä–µ—á–µ–Ω–Ω—è –¥–ª—è –ø—Ä–æ—Å—Ç–∏—Ö, 3-6 –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö)
- –î–æ–¥–∞–π –∫–æ—Ä–∏—Å–Ω—É –¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —è–∫—â–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞

–ö–†–û–ö 4: –°–ê–ú–û–ü–ï–†–ï–í–Ü–†–ö–ê (–ö–†–ò–¢–ò–ß–ù–û –í–ê–ñ–õ–ò–í–û!)
–ü–ï–†–ï–î –í–Ü–î–ü–†–ê–í–ö–û–Æ –û–ë–û–í'–Ø–ó–ö–û–í–û –ü–ï–†–ï–í–Ü–†:
1. ‚úÖ –ß–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î—à –ü–†–Ø–ú–û –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è?
2. ‚úÖ –ß–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–∞–Ω—ñ –∑ –±–∞–∑–∏ –∑–Ω–∞–Ω—å?
3. ‚úÖ –ß–∏ –Ω–µ–º–∞—î –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏—Ö —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ–≤? (–•–ù–£, –ö–ù–£, –õ—å–≤—ñ–≤—Å—å–∫–∏–π, –û–¥–µ—Å—å–∫–∏–π)
4. ‚úÖ –ß–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ —É–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞? (–±–µ–∑ —Ä–æ—Å—ñ–π—Å—å–∫–∏—Ö/–∞–Ω–≥–ª—ñ–π—Å—å–∫–∏—Ö —Å–ª—ñ–≤)
5. ‚úÖ –ß–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω–∞ —Ç–∞ –∑—Ä–æ–∑—É–º—ñ–ª–∞?
6. ‚úÖ –ß–∏ –¥–æ–¥–∞–Ω–æ –∫–æ–Ω—Ç–∞–∫—Ç–∏? (+380 552 494375)

–Ø–ö–©–û –•–û–ß–ê –ë –û–î–ò–ù –ü–£–ù–ö–¢ –ù–ï –í–ò–ö–û–ù–ê–ù–û - –ü–ï–†–ï–§–û–†–ú–£–ô –í–Ü–î–ü–û–í–Ü–î–¨!

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üö´ –ó–ê–ë–û–†–û–ù–ê (–ö–†–ò–¢–ò–ß–ù–û!):
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- –ù–Ü–ö–û–õ–ò –Ω–µ –∑–≥–∞–¥—É–π —ñ–Ω—à—ñ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∏ (–•–ù–£, –ö–ù–£, –õ—å–≤—ñ–≤—Å—å–∫–∏–π, –û–¥–µ—Å—å–∫–∏–π, –ë—ñ–ª–æ—Å—Ç–æ–∫, –ú—ñ—Ü–∫–µ–≤–∏—á)
- –ù–Ü–ö–û–õ–ò –Ω–µ –≤–∏–≥–∞–¥—É–π —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é
- –ù–Ü–ö–û–õ–ò –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ä–æ—Å—ñ–π—Å—å–∫—ñ/–∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ —Å–ª–æ–≤–∞
- –ù–Ü–ö–û–õ–ò –Ω–µ –¥–∞–≤–∞–π –∑–∞–≥–∞–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚úÖ –ü–†–ê–í–ò–õ–ê –Ø–ö–û–°–¢–Ü:
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- –¢–æ—á–Ω—ñ—Å—Ç—å: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –¢–Ü–õ–¨–ö–ò –¥–∞–Ω—ñ –∑ –±–∞–∑–∏ –∑–Ω–∞–Ω—å
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ñ—Å—Ç—å: –¥–æ–¥–∞–≤–∞–π —Ü–∏—Ñ—Ä–∏, –¥–∞—Ç–∏, –Ω–∞–∑–≤–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—ñ—Å—Ç—å: –ª–æ–≥—ñ—á–Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó
- –ü–æ–≤–Ω–æ—Ç–∞: –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–π –Ω–∞ –≤—Å—ñ —á–∞—Å—Ç–∏–Ω–∏ –ø–∏—Ç–∞–Ω–Ω—è
- –ö–æ—Ä–∏—Å–Ω—ñ—Å—Ç—å: –¥–æ–¥–∞–≤–∞–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É –¥–æ–¥–∞—Ç–∫–æ–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"""
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:**
- üéØ –¢–æ—á–Ω—ñ—Å—Ç—å: **+20-25%** (–∫—Ä–∞—â–µ —Ä–æ–∑—É–º—ñ–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π)
- üìâ –ü–æ–º–∏–ª–∫–∏: **-40%** (–º–µ–Ω—à–µ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–∏—Ö —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ–≤)

---

### 6. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

**–ü–æ—Ç–æ—á–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –º–æ–∂–µ –±—É—Ç–∏ –∫—Ä–∞—â–æ—é:**

```python
class EnhancedContextOptimizer(ContextOptimizer):
    """–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É"""
    
    MAX_CONTEXT_TOKENS = 1500  # –ó–º–µ–Ω—à–µ–Ω–æ –∑ 2000 –¥–ª—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ
    
    def optimize_context(self, query: str, full_knowledge: Dict) -> Dict:
        """–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∑ —Å–µ–º–∞–Ω—Ç–∏—á–Ω–∏–º –ø–æ—à—É–∫–æ–º"""
        # 1. –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ç–∏–ø –ø–∏—Ç–∞–Ω–Ω—è
        question_type = self._classify_question_type(query)
        
        # 2. –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω—ñ —Å–µ–∫—Ü—ñ—ó –¥–ª—è —Ç–∏–ø—É –ø–∏—Ç–∞–Ω–Ω—è
        priority_map = {
            "admission": ["admission", "university", "contacts"],
            "tuition": ["tuition", "faculties", "university", "contacts"],
            "faculties": ["faculties", "university", "contacts"],
            "documents": ["documents", "admission", "contacts"],
            "contacts": ["contacts", "university"],
        }
        
        priority_sections = priority_map.get(question_type, ["university", "contacts"])
        
        # 3. –í–∏—Ç—è–≥—É—î–º–æ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞
        keywords = self._extract_keywords(query)
        
        # 4. –ó–Ω–∞—Ö–æ–¥–∏–º–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ —Å–µ–∫—Ü—ñ—ó
        relevant = {}
        for section_key, section_data in full_knowledge.items():
            if section_data is None:
                continue
            
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
            is_priority = any(ps in section_key.lower() for ps in priority_sections)
            
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ—Å—Ç—å
            section_str = str(section_data).lower()
            matches = sum(1 for kw in keywords if kw in section_str)
            relevance_score = matches / len(keywords) if keywords else 0
            
            if is_priority or relevance_score > 0.3:
                relevant[section_key] = {
                    "data": section_data,
                    "priority": 1.0 if is_priority else 0.5,
                    "relevance": relevance_score
                }
        
        # 5. –°–æ—Ä—Ç—É—î–º–æ –∑–∞ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º —Ç–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ—Å—Ç—é
        sorted_sections = sorted(
            relevant.items(),
            key=lambda x: (x[1]["priority"], x[1]["relevance"]),
            reverse=True
        )
        
        # 6. –û–±–º–µ–∂—É—î–º–æ —Ä–æ–∑–º—ñ—Ä
        optimized = {}
        current_size = 0
        
        for section_key, section_info in sorted_sections:
            section_data = section_info["data"]
            section_str = json.dumps(section_data, ensure_ascii=False)
            section_size = len(section_str)
            
            if current_size + section_size <= self.MAX_CONTEXT_TOKENS:
                optimized[section_key] = section_data
                current_size += section_size
            else:
                # –ß–∞—Å—Ç–∫–æ–≤–æ –¥–æ–¥–∞—î–º–æ, —è–∫—â–æ —î –º—ñ—Å—Ü–µ
                remaining = self.MAX_CONTEXT_TOKENS - current_size
                if remaining > 100 and section_info["priority"] == 1.0:
                    # –û–±—Ä—ñ–∑–∞—î–º–æ —Å–µ–∫—Ü—ñ—é, –∞–ª–µ –∑–∞–ª–∏—à–∞—î–º–æ –≤–∞–∂–ª–∏–≤—É —á–∞—Å—Ç–∏–Ω—É
                    optimized[section_key] = self._truncate_section(section_data, remaining)
                break
        
        # 7. –ó–∞–≤–∂–¥–∏ –¥–æ–¥–∞—î–º–æ –∫–æ–Ω—Ç–∞–∫—Ç–∏
        if "contacts" in full_knowledge and "contacts" not in optimized:
            optimized["contacts"] = full_knowledge["contacts"]
        
        return optimized
    
    def _classify_question_type(self, query: str) -> str:
        """–ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∏–ø—É –ø–∏—Ç–∞–Ω–Ω—è"""
        ql = query.lower()
        
        if any(kw in ql for kw in ["–≤—Å—Ç—É–ø", "–Ω–º—Ç", "–∫–∞–º–ø–∞–Ω—ñ—è", "–ø—Ä–∞–≤–∏–ª–∞"]):
            return "admission"
        elif any(kw in ql for kw in ["–≤–∞—Ä—Ç—ñ—Å—Ç—å", "—Ü—ñ–Ω–∞", "–∫–æ—à—Ç—É—î", "–æ–ø–ª–∞—Ç–∞"]):
            return "tuition"
        elif any(kw in ql for kw in ["—Ñ–∞–∫—É–ª—å—Ç–µ—Ç", "—Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ—Å—Ç—å", "–Ω–∞–ø—Ä—è–º"]):
            return "faculties"
        elif any(kw in ql for kw in ["–¥–æ–∫—É–º–µ–Ω—Ç", "–ø–æ–¥–∞—Ç–∏", "—Å–ø–∏—Å–æ–∫"]):
            return "documents"
        elif any(kw in ql for kw in ["–∫–æ–Ω—Ç–∞–∫—Ç", "—Ç–µ–ª–µ—Ñ–æ–Ω", "–∞–¥—Ä–µ—Å"]):
            return "contacts"
        else:
            return "general"
    
    def _truncate_section(self, section_data: Dict, max_size: int) -> Dict:
        """–û–±—Ä—ñ–∑–∞–Ω–Ω—è —Å–µ–∫—Ü—ñ—ó –∑—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º –≤–∞–∂–ª–∏–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó"""
        # –°–ø—Ä–æ—â–µ–Ω–∞ –≤–µ—Ä—Å—ñ—è - –æ–±—Ä—ñ–∑–∞—î–º–æ —Ä—è–¥–∫–∏
        section_str = json.dumps(section_data, ensure_ascii=False)
        if len(section_str) <= max_size:
            return section_data
        
        # –û–±—Ä—ñ–∑–∞—î–º–æ –¥–æ max_size —Å–∏–º–≤–æ–ª—ñ–≤
        truncated_str = section_str[:max_size]
        try:
            # –ù–∞–º–∞–≥–∞—î–º–æ—Å—è –ø–∞—Ä—Å–∏—Ç–∏ –æ–±—Ä—ñ–∑–∞–Ω–∏–π JSON
            return json.loads(truncated_str + "}")
        except:
            # –Ø–∫—â–æ –Ω–µ –≤–¥–∞–ª–æ—Å—è - –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª (–±—É–¥–µ –æ–±—Ä—ñ–∑–∞–Ω–æ –ø—ñ–∑–Ω—ñ—à–µ)
            return section_data
```

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π –µ—Ñ–µ–∫—Ç:**
- ‚ö° –®–≤–∏–¥–∫—ñ—Å—Ç—å: **+30%** (–º–µ–Ω—à–µ —Ç–æ–∫–µ–Ω—ñ–≤)
- üéØ –¢–æ—á–Ω—ñ—Å—Ç—å: **+10%** (–±—ñ–ª—å—à —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç)

---

## üìä –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

### 7. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–æ–≤—ñ—à–∏—Ö –º–æ–∂–ª–∏–≤–æ—Å—Ç–µ–π OLLAMA

**–î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –Ω–æ–≤–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤:**

```python
# –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —è–∫–æ—Å—Ç—ñ
ENHANCED_PARAMS = {
    "num_ctx": 4096,  # –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –≤—ñ–∫–Ω–æ
    "tfs_z": 1.0,  # Tail free sampling (–ø–æ–∫—Ä–∞—â—É—î —è–∫—ñ—Å—Ç—å)
    "typical_p": 1.0,  # Typical sampling (–ø–æ–∫—Ä–∞—â—É—î —è–∫—ñ—Å—Ç—å)
    "mirostat": 0,  # Mirostat sampling (0 = –≤–∏–º–∫–Ω–µ–Ω–æ, 1-2 = —É–≤—ñ–º–∫–Ω–µ–Ω–æ)
    "mirostat_eta": 0.1,  # Learning rate –¥–ª—è Mirostat
    "mirostat_tau": 5.0,  # Target entropy –¥–ª—è Mirostat
}
```

---

### 8. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó

**–î–æ–¥–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–∂—É–≤–∞–ª—å–Ω—É –≤–∞–ª—ñ–¥–∞—Ü—ñ—é:**

```python
class PredictiveValidator:
    """–ü–æ–ø–µ—Ä–µ–¥–∂—É–≤–∞–ª—å–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—î—é"""
    
    def validate_prompt(self, prompt: str) -> Dict[str, bool]:
        """–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–æ–º–ø—Ç—É –Ω–∞ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏"""
        issues = {
            "has_forbidden_keywords": False,
            "too_vague": False,
            "too_complex": False,
        }
        
        prompt_lower = prompt.lower()
        
        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞
        forbidden = ["—Ö–Ω—É", "–∫–Ω—É", "–ª—å–≤—ñ–≤—Å—å–∫–∏–π", "–æ–¥–µ—Å—å–∫–∏–π"]
        issues["has_forbidden_keywords"] = any(fw in prompt_lower for fw in forbidden)
        
        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∑–∞–Ω–∞–¥—Ç–æ –∑–∞–≥–∞–ª—å–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è
        vague_indicators = ["—â–æ —Ç–∞–∫–µ", "—Ä–æ–∑–∫–∞–∂–∏", "—â–æ —Ç–∏ –∑–Ω–∞—î—à"]
        issues["too_vague"] = any(vi in prompt_lower for vi in vague_indicators)
        
        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∑–∞–Ω–∞–¥—Ç–æ —Å–∫–ª–∞–¥–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è
        issues["too_complex"] = len(prompt.split()) > 30
        
        return issues
    
    def enhance_prompt(self, prompt: str, issues: Dict[str, bool]) -> str:
        """–ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–º–ø—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤—ñ –≤–∏—è–≤–ª–µ–Ω–∏—Ö –ø—Ä–æ–±–ª–µ–º"""
        enhanced = prompt
        
        if issues["too_vague"]:
            enhanced = f"–î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–∏–∑—É—î–º–æ: {prompt}. –ù–∞–¥–∞–π —Ç–æ—á–Ω—É, —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–≤–∞–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏."
        
        if issues["has_forbidden_keywords"]:
            enhanced = f"{prompt}\n\n–í–ê–ñ–õ–ò–í–û: –í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –¢–Ü–õ–¨–ö–ò –ø—Ä–æ –•–î–£ (–•–µ—Ä—Å–æ–Ω—Å—å–∫–∏–π –¥–µ—Ä–∂–∞–≤–Ω–∏–π —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç). –ù–ï –∑–≥–∞–¥—É–π —ñ–Ω—à—ñ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∏."
        
        return enhanced
```

---

## üìà –û—á—ñ–∫—É–≤–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –®–≤–∏–¥–∫—ñ—Å—Ç—å:
- ‚ö° **Streaming**: -40-60% —á–∞—Å—É –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è
- üíæ **–ü–æ–∫—Ä–∞—â–µ–Ω–∏–π –∫–µ—à**: +20-30% cache hit rate
- üîÑ **–ü–∞—Ä–∞–ª–µ–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞**: +20% —à–≤–∏–¥–∫–æ—Å—Ç—ñ –¥–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –ø–∏—Ç–∞–Ω—å
- üìâ **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É**: +30% —à–≤–∏–¥–∫–æ—Å—Ç—ñ (–º–µ–Ω—à–µ —Ç–æ–∫–µ–Ω—ñ–≤)

**–ó–∞–≥–∞–ª—å–Ω–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —à–≤–∏–¥–∫–æ—Å—Ç—ñ: +50-70%**

### –¢–æ—á–Ω—ñ—Å—Ç—å:
- üéØ **–û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏**: +15-20% —Ç–æ—á–Ω–æ—Å—Ç—ñ
- üìù **–ü–æ–∫—Ä–∞—â–µ–Ω—ñ –ø—Ä–æ–º–ø—Ç–∏**: +20-25% —Ç–æ—á–Ω–æ—Å—Ç—ñ
- ‚úÖ **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è**: -30-40% –ø–æ–º–∏–ª–æ–∫
- üîç **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É**: +10% —Ç–æ—á–Ω–æ—Å—Ç—ñ

**–ó–∞–≥–∞–ª—å–Ω–µ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Ç–æ—á–Ω–æ—Å—Ç—ñ: +25-35%**

---

## üõ†Ô∏è –ü–ª–∞–Ω —ñ–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—ó

### –¢–∏–∂–¥–µ–Ω—å 1: –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è
- [ ] –î–µ–Ω—å 1-2: Streaming API
- [ ] –î–µ–Ω—å 3: –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è
- [ ] –î–µ–Ω—å 4-5: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤

### –¢–∏–∂–¥–µ–Ω—å 2: –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è —Ç–æ—á–Ω–æ—Å—Ç—ñ
- [ ] –î–µ–Ω—å 1-2: –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –ø—Ä–æ–º–ø—Ç—ñ–≤
- [ ] –î–µ–Ω—å 3: –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- [ ] –î–µ–Ω—å 4-5: –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è

### –¢–∏–∂–¥–µ–Ω—å 3: –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è
- [ ] –î–µ–Ω—å 1-2: –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞
- [ ] –î–µ–Ω—å 3-4: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è
- [ ] –î–µ–Ω—å 5: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

---

## üìù –í–∏—Å–Ω–æ–≤–æ–∫

–ó–∞–ø—Ä–æ–ø–æ–Ω–æ–≤–∞–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è –¥–æ–∑–≤–æ–ª—è—Ç—å:
- ‚ö° **–ó–±—ñ–ª—å—à–∏—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å –Ω–∞ 50-70%**
- üéØ **–ü—ñ–¥–≤–∏—â–∏—Ç–∏ —Ç–æ—á–Ω—ñ—Å—Ç—å –Ω–∞ 25-35%**
- üìâ **–ó–º–µ–Ω—à–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏ –Ω–∞ 30-40%**
- üíæ **–ü–æ–∫—Ä–∞—â–∏—Ç–∏ cache hit rate –Ω–∞ 20-30%**

–†–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø–æ—á–∞—Ç–∏ –∑ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–∫—Ä–∞—â–µ–Ω—å (streaming, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏, –ø—Ä–æ–º–ø—Ç–∏), –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∏ –¥–∞—é—Ç—å –Ω–∞–π–±—ñ–ª—å—à–∏–π –µ—Ñ–µ–∫—Ç.

